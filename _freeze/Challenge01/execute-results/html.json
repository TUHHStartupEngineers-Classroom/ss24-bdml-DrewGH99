{
  "hash": "e3d4387b75da5a2a765d2bdfd63d61c7",
  "result": {
    "markdown": "---\ntitle: \"Machine Learning Fundamentals\"\nsubtitle: \"Business Decisions with Machine Learning\"\nauthor: \"Drew Gilmore\"\n---\n\n\n# Step 1\n\n::: {.cell hash='Challenge01_cache/html/unnamed-chunk-1_a27030f8c582cb0cc053c01f3d4ea1ce'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidyquant)\nlibrary(broom)\nlibrary(umap)\n\nsp_500_daily_returns_tbl  <- read_rds(\"Challenge 1/sp_500_prices_tbl.rds\") %>%\n  select(symbol, date, adjusted) %>%\n  filter(year(date) >= 2018 ) %>%\n  group_by(symbol) %>%\n  mutate(lagPrice = lag(adjusted, n = 1L)) %>%\n  filter(is.na(lagPrice) == 0) %>%\n  mutate(priceDif = adjusted - lagPrice) %>%\n  mutate(pct_return = priceDif/lagPrice) %>%\n  ungroup(symbol) %>%\n  select(symbol, date, pct_return)\n\nhead(sp_500_daily_returns_tbl, n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 3\n   symbol date       pct_return\n   <chr>  <date>          <dbl>\n 1 MSFT   2018-01-03   0.00465 \n 2 MSFT   2018-01-04   0.00880 \n 3 MSFT   2018-01-05   0.0124  \n 4 MSFT   2018-01-08   0.00102 \n 5 MSFT   2018-01-09  -0.000680\n 6 MSFT   2018-01-10  -0.00453 \n 7 MSFT   2018-01-11   0.00296 \n 8 MSFT   2018-01-12   0.0173  \n 9 MSFT   2018-01-16  -0.0140  \n10 MSFT   2018-01-17   0.0203  \n```\n:::\n:::\n\n\n# Step 2\n\n::: {.cell hash='Challenge01_cache/html/unnamed-chunk-2_c5a8df4ae2d0aa7a226dd694f80bcdac'}\n\n```{.r .cell-code}\nstock_date_matrix_tbl <- sp_500_daily_returns_tbl %>%\n  pivot_wider(names_from = date, values_from = pct_return)\nhead(stock_date_matrix_tbl, n=10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 283\n   symbol `2018-01-03` `2018-01-04` `2018-01-05` `2018-01-08` `2018-01-09`\n   <chr>         <dbl>        <dbl>        <dbl>        <dbl>        <dbl>\n 1 MSFT       0.00465     0.00880       0.0124        0.00102    -0.000680\n 2 AAPL      -0.000174    0.00465       0.0114       -0.00371    -0.000115\n 3 AMZN       0.0128      0.00448       0.0162        0.0144      0.00468 \n 4 FB         0.0179     -0.00184       0.0137        0.00765    -0.00218 \n 5 JNJ        0.00955    -0.0000712     0.00825       0.00127     0.0159  \n 6 JPM        0.00102     0.0143       -0.00642       0.00148     0.00507 \n 7 GOOG       0.0164      0.00362       0.0146        0.00427    -0.000614\n 8 GOOGL      0.0171      0.00388       0.0133        0.00353    -0.00127 \n 9 XOM        0.0196      0.00138      -0.000806      0.00450    -0.00425 \n10 BAC       -0.00334     0.0131        0.00464      -0.00692     0.00498 \n# ℹ 277 more variables: `2018-01-10` <dbl>, `2018-01-11` <dbl>,\n#   `2018-01-12` <dbl>, `2018-01-16` <dbl>, `2018-01-17` <dbl>,\n#   `2018-01-18` <dbl>, `2018-01-19` <dbl>, `2018-01-22` <dbl>,\n#   `2018-01-23` <dbl>, `2018-01-24` <dbl>, `2018-01-25` <dbl>,\n#   `2018-01-26` <dbl>, `2018-01-29` <dbl>, `2018-01-30` <dbl>,\n#   `2018-01-31` <dbl>, `2018-02-01` <dbl>, `2018-02-02` <dbl>,\n#   `2018-02-05` <dbl>, `2018-02-06` <dbl>, `2018-02-07` <dbl>, …\n```\n:::\n:::\n\n\n# Step 3\n\n::: {.cell hash='Challenge01_cache/html/unnamed-chunk-3_eae2157ce10b0b0c38b638b7703de6d5'}\n\n```{.r .cell-code}\nstock_date_matrix_tbl <- read_rds(\"Challenge 1/stock_date_matrix_tbl.rds\")\n\nkmeans_obj <- stock_date_matrix_tbl %>% \n  select(-symbol) %>%\n  kmeans(centers = 4, nstart = 20)\n\nbroom::glance(kmeans_obj)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 4\n  totss tot.withinss betweenss  iter\n  <dbl>        <dbl>     <dbl> <int>\n1  33.6         29.2      4.40     3\n```\n:::\n:::\n\n\n# Step 4\n\n::: {.cell hash='Challenge01_cache/html/plot_d95620591eaed8d9bc5e3698442497b9'}\n\n```{.r .cell-code}\nkmeans_mapper <- function(center = 3) {\n  stock_date_matrix_tbl %>%\n    select(-symbol) %>%\n    kmeans(centers = center, nstart = 20)\n}\n\nkmeans_mapped_tbl <- tibble(centers = 1:30) %>%\n  mutate(k_means = centers %>% map(kmeans_mapper)) %>%\n  mutate(glance  = k_means %>% map(glance))\n\nkmeans_mapped_tbl %>%\n  unnest(glance) %>%\n  select(centers, tot.withinss) %>%\n  ggplot(aes(centers, tot.withinss)) +\n  geom_point(color = \"black\", size = 4) +\n  geom_line(color = \"gray\", size = 1) +\n  ggrepel::geom_label_repel(aes(label = centers), color = \"black\") +\n  theme_minimal() +\n  labs(title = \"Skree Plot\")\n```\n\n::: {.cell-output-display}\n![](Challenge01_files/figure-html/plot-1.png){width=672}\n:::\n:::\n\n\n# Step 5\n\n::: {.cell hash='Challenge01_cache/html/plot2_aa7346e235685e4e7ed68befd31cb804'}\n\n```{.r .cell-code}\nk_means_mapped_tbl <- read_rds(\"Challenge 1/k_means_mapped_tbl.rds\")\n\numap_results <- stock_date_matrix_tbl %>%\n  select(-symbol) %>%\n  umap()\n\numap_results_tbl <- umap_results$layout %>%\n  as_tibble(.name_repair = \"unique\") %>% \n  set_names(c(\"V1\", \"V2\")) %>%\n  bind_cols(\n    stock_date_matrix_tbl %>% select(symbol)\n  )\n\numap_results_tbl %>%\n  ggplot(aes(V1, V2)) +\n  geom_point(alpha = 0.5) + \n  labs(title = \"UMAP Projection\") +\n  theme_tq()\n```\n\n::: {.cell-output-display}\n![](Challenge01_files/figure-html/plot2-1.png){width=672}\n:::\n:::\n\n\n# Step 6\n\n::: {.cell hash='Challenge01_cache/html/plot3_b6186ee41ed78ffaaa3ac4c86c73b368'}\n\n```{.r .cell-code}\nk_means_mapped_tbl <- read_rds(\"Challenge 1/k_means_mapped_tbl.rds\")\numap_results_tbl   <- read_rds(\"Challenge 1/umap_results_tbl.rds\")\nsp_500_index_tbl <- read_rds(\"Challenge 1/sp_500_index_tbl.rds\")\n\nkmeans_10_obj <- k_means_mapped_tbl %>%\n  pull(k_means) %>%\n  pluck(10)\n\nkmeans_10_clusters_tbl <- kmeans_10_obj %>% \n  augment(stock_date_matrix_tbl) %>%\n  select(symbol, .cluster)\n\numap_kmeans_results_tbl <- umap_results_tbl %>%\n  left_join(kmeans_10_clusters_tbl, by = join_by(symbol)) %>%\n  left_join(sp_500_index_tbl %>%\n              select(symbol, company, sector),\n              by = join_by(symbol))\n\numap_kmeans_results_tbl %>%\n  ggplot(aes(V1, V2, color = .cluster)) +\n  geom_point(alpha = 0.5) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(title = \"Company Segmentation: 2D Projection\")\n```\n\n::: {.cell-output-display}\n![](Challenge01_files/figure-html/plot3-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}